{% extends 'base.html.twig' %}

{% block title %}Profilim | PehliONE{% endblock %}

{% block body %}
	{% set inputClass =
		'block w-full rounded-xl border-0 bg-white px-3 py-2 text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm'
	%}
	{% set labelClass = 'block text-sm font-medium text-slate-900' %}
	{% set helpClass  = 'mt-1 text-sm text-slate-600' %}
	{% set cardClass  = 'rounded-2xl bg-white p-6 shadow-sm ring-1 ring-slate-200' %}

	<div class="bg-slate-50">
		<div class="mx-auto max-w-6xl px-4 py-8 sm:px-6 lg:px-8">
			<div class="flex items-start justify-between gap-6">
				<div>
					<h1 class="text-2xl font-semibold tracking-tight text-slate-900">Profil</h1>
					<p class="mt-1 text-sm text-slate-600">Kişisel bilgilerinizi ve profil fotoğrafınızı yönetin.</p>
				</div>
				<a href="{{ path('app_logout') }}"
				   class="inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 ring-1 ring-inset ring-slate-300 hover:bg-white">
					Çıkış Yap
				</a>
			</div>

			{# Flash messages #}
			<div class="mt-6 space-y-3">
				{% for message in app.flashes('success') %}
					<div class="rounded-xl bg-emerald-50 p-4 text-sm text-emerald-800 ring-1 ring-emerald-200">
						{{ message }}
					</div>
				{% endfor %}
				{% for message in app.flashes('error') %}
					<div class="rounded-xl bg-rose-50 p-4 text-sm text-rose-800 ring-1 ring-rose-200">
						{{ message }}
					</div>
				{% endfor %}
			</div>

			<div class="mt-6 grid grid-cols-1 gap-6 lg:grid-cols-12">
				{# Left: account summary + photo #}
				<aside class="lg:col-span-4">
					<div class="{{ cardClass }}">
						<div class="flex items-center gap-4">
							<div class="h-16 w-16 overflow-hidden rounded-full bg-slate-100 ring-1 ring-slate-200">
								{% set photoPath = app.user.avatarPath ?? null %}
								{% if photoPath %}
									<img src="{{ asset(photoPath) }}" alt="Profil fotoğrafı" class="h-full w-full object-cover">
								{% else %}
									<div class="flex h-full w-full items-center justify-center text-slate-600 font-semibold">
										{{ (app.user.firstname|default('U')|slice(0,1))|upper }}{{ (app.user.lastname|default('')|slice(0,1))|upper }}
									</div>
								{% endif %}
							</div>
							<div class="min-w-0">
								<p class="truncate text-sm font-semibold text-slate-900">
									{{ app.user.firstname }} {{ app.user.lastname }}
								</p>
								<p class="truncate text-sm text-slate-600">{{ app.user.email }}</p>
							</div>
						</div>

						<dl class="mt-6 space-y-3">
							<div class="flex items-center justify-between gap-4">
								<dt class="text-sm text-slate-600">Üyelik</dt>
								<dd class="text-sm font-medium text-slate-900">
									{{ (app.user.createdAt ?? null) ? app.user.createdAt|date('M d, Y') : '—' }}
								</dd>
							</div>
							<div class="flex items-center justify-between gap-4">
								<dt class="text-sm text-slate-600">Rol</dt>
								<dd class="text-sm font-medium text-slate-900">
									{% if is_granted('ROLE_ADMIN') %}Admin{% else %}Üye{% endif %}
								</dd>
							</div>
						</dl>

						<div class="mt-6 border-t border-slate-200 pt-6">
							<p class="text-sm font-medium text-slate-900">Profil Fotoğrafı</p>
							<p class="{{ helpClass }}">PNG/JPG önerilir. Maksimum 2MB.</p>

							<div class="mt-4 flex flex-wrap items-center gap-3" data-controller="file-input">
								<label class="inline-flex cursor-pointer items-center justify-center rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
									Fotoğraf seç
									{{ form_widget(form.avatar, { attr: { class: 'sr-only', 'data-file-input-target': 'input', 'data-action': 'change->file-input#updateName' } }) }}
								</label>

								<p class="mt-2 text-sm text-slate-600" data-file-input-target="name">Dosya seçilmedi</p>

							</div>

							{% if form.avatar is defined %}
								<div class="mt-2 text-sm text-rose-600">
									{{ form_errors(form.avatar) }}
								</div>
							{% endif %}
						</div>
					</div>
				</aside>

				{# Right: Form #}
				<section class="lg:col-span-8">
					<div class="{{ cardClass }}">
						<div class="flex items-center justify-between gap-4">
							<div>
								<h2 class="text-lg font-semibold text-slate-900">Kişisel Bilgiler</h2>
								<p class="mt-1 text-sm text-slate-600">Bu bilgiler sipariş ve iletişim süreçlerinde kullanılır.</p>
							</div>
						</div>

						<div class="mt-6">
							{{ form_start(form, { attr: { class: 'space-y-6' } }) }}

							{# Form genel hataları #}
							{% if form.vars.errors|length > 0 %}
								<div class="rounded-xl bg-rose-50 p-4 text-sm text-rose-800 ring-1 ring-rose-200">
									{{ form_errors(form) }}
								</div>
							{% endif %}

							<div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
								{# First name #}
								{% if form.firstname is defined %}
									<div>
										<label class="{{ labelClass }}" for="{{ form.firstname.vars.id }}">Ad</label>
										<div class="mt-2">
											{{ form_widget(form.firstname, { attr: { class: inputClass, autocomplete: 'given-name' } }) }}
										</div>
										<div class="mt-2 text-sm text-rose-600">{{ form_errors(form.firstname) }}</div>
									</div>
								{% endif %}

								{# Last name #}
								{% if form.lastname is defined %}
									<div>
										<label class="{{ labelClass }}" for="{{ form.lastname.vars.id }}">Soyad</label>
										<div class="mt-2">
											{{ form_widget(form.lastname, { attr: { class: inputClass, autocomplete: 'family-name' } }) }}
										</div>
										<div class="mt-2 text-sm text-rose-600">{{ form_errors(form.lastname) }}</div>
									</div>
								{% endif %}

								{# Email #}
								{% if form.email is defined %}
									<div class="sm:col-span-2">
										<label class="{{ labelClass }}" for="{{ form.email.vars.id }}">E-posta</label>
										<div class="mt-2">
											{{ form_widget(form.email, { attr: { class: inputClass, autocomplete: 'email' } }) }}
										</div>
										<p class="{{ helpClass }}">E-posta değişimi doğrulama gerektirebilir (isterseniz sonraki adımda ekleriz).</p>
										<div class="mt-2 text-sm text-rose-600">{{ form_errors(form.email) }}</div>
									</div>
								{% endif %}

								{# Member since (read-only) #}
								<div class="sm:col-span-2">
									<label class="{{ labelClass }}">Üyelik Tarihi</label>
									<div class="mt-2">
										<input
											type="text"
											value="{{ (app.user.createdAt ?? null) ? app.user.createdAt|date('M d, Y') : '' }}"
											readonly
											class="block w-full rounded-xl border-0 bg-slate-50 px-3 py-2 text-slate-700 shadow-sm ring-1 ring-inset ring-slate-200 sm:text-sm"
										/>
									</div>
								</div>
							</div>

							<div class="flex items-center justify-end gap-3 border-t border-slate-200 pt-6">
								<a href="{{ path('app_home') }}"
								   class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 ring-1 ring-inset ring-slate-300 hover:bg-slate-50">
									Vazgeç
								</a>
								<button type="submit"
										class="inline-flex items-center justify-center rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
									Kaydet
								</button>
							</div>

							{{ form_end(form) }}
						</div>
					</div>

					<div class="mt-6 rounded-2xl bg-white p-6 shadow-sm ring-1 ring-slate-200">
						<h3 class="text-sm font-semibold text-slate-900">Güvenlik</h3>
						<p class="mt-1 text-sm text-slate-600">Şifre değiştirme gibi işlemleri ayrı bir ekranda yönetmek daha güvenlidir.</p>
						<div class="mt-4">
							<a href="{{ path('app_change_password') }}"
							   class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 ring-1 ring-inset ring-slate-300 hover:bg-slate-50">
								Şifre Değiştir
							</a>
						</div>
					</div>
				</section>
			</div>
		</div>
	</div>
{% endblock %}
