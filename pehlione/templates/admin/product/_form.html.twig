{{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

{% if form_errors(form) %}
	<div class="rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800">
		{{ form_errors(form) }}
	</div>
{% endif %}

{% set inputClass = 'block w-full rounded-xl border-gray-300 shadow-sm focus:border-black focus:ring-black' %}

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
	<div>
		<label class="block text-sm font-medium text-gray-900" for="{{ form.name.vars.id }}">Ad</label>
		<div class="mt-2">{{ form_widget(form.name, { attr: { class: inputClass } }) }}</div>
		<p class="mt-2 text-xs text-gray-500">Storefront'ta görünen ürün adı.</p>
	</div>

	<div>
		<label class="block text-sm font-medium text-gray-900" for="{{ form.slug.vars.id }}">Slug</label>
		<div class="mt-2">{{ form_widget(form.slug, { attr: { class: inputClass } }) }}</div>
		<p class="mt-2 text-xs text-gray-500">URL'de kullanılır (örn. pehlione-deri-kemer).</p>
	</div>

	<div>
		<label class="block text-sm font-medium text-gray-900" for="{{ form.category.vars.id }}">Kategori</label>
		<div class="mt-2">{{ form_widget(form.category, { attr: { class: inputClass } }) }}</div>
	</div>

	<div class="grid grid-cols-2 gap-4">
		<div>
			<label class="block text-sm font-medium text-gray-900" for="{{ form.priceAmount.vars.id }}">Fiyat (cent)</label>
			<div class="mt-2">{{ form_widget(form.priceAmount, { attr: { class: inputClass } }) }}</div>
			{% if form.priceAmount.vars.help %}
				<p class="mt-2 text-xs text-gray-500">{{ form.priceAmount.vars.help }}</p>
			{% endif %}
		</div>

		<div>
			<label class="block text-sm font-medium text-gray-900" for="{{ form.currency.vars.id }}">Para Birimi</label>
			<div class="mt-2">{{ form_widget(form.currency, { attr: { class: inputClass } }) }}</div>
		</div>
	</div>

	<div>
		<label class="block text-sm font-medium text-gray-900" for="{{ form.stockQuantity.vars.id }}">Stok</label>
		<div class="mt-2">{{ form_widget(form.stockQuantity, { attr: { class: inputClass } }) }}</div>
	</div>

	<div class="flex items-center gap-3">
		{{ form_widget(form.isActive, { attr: { class: 'h-4 w-4 rounded border-gray-300 text-black focus:ring-black' } }) }}
		<label class="text-sm font-medium text-gray-900" for="{{ form.isActive.vars.id }}">Aktif</label>
	</div>
</div>

<div>
	<label class="block text-sm font-medium text-gray-900" for="{{ form.description.vars.id }}">Açıklama</label>
	<div class="mt-2">{{ form_widget(form.description, { attr: { class: inputClass, rows: 6 } }) }}</div>
</div>

<div>
	<label class="block text-sm font-medium text-gray-900" for="{{ form.imageUrl.vars.id }}">Resim URL</label>
	<div class="mt-2">{{ form_widget(form.imageUrl, { attr: { class: inputClass } }) }}</div>
	<p class="mt-2 text-xs text-gray-500">Ürün resminin URL'si. Örn: /images/products/643/thumbnail.jpg</p>
</div>

<div class="border-t pt-6">
	<div class="text-sm font-medium text-gray-900">Fotoğraflar</div>
	<p class="mt-1 text-sm text-gray-600">Sürükle-bırak veya dosya seçerek yükleyin.</p>

	<div id="dropzone" class="mt-4 flex justify-center rounded-xl border border-dashed border-gray-300 bg-gray-50 px-6 py-10">
		<div class="text-center">
			<div class="text-sm text-gray-600">
				<label for="{{ form.imageFiles.vars.id }}" class="cursor-pointer font-medium underline">
					Dosya seç
				</label>
				<span>
					veya buraya bırak</span>
			</div>
			<p class="mt-2 text-xs text-gray-500">PNG, JPG, WEBP (maks 10MB)</p>

			<div class="mt-4">
				{{ form_widget(form.imageFiles, {'attr': {'class': 'sr-only'}}) }}
			</div>

			<div id="filelist" class="mt-3 text-xs text-gray-600"></div>
		</div>
	</div>

	{% if product is defined and product.productImages|length > 0 %}
		<div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-3">
			{% for img in product.productImages %}
				<div class="rounded-xl border bg-white p-2">
					<img src="{{ asset(img.path) }}" alt="{{ img.altText ?: product.name }}" class="h-24 w-full rounded-lg object-cover bg-gray-100">
					<div class="mt-2 text-xs text-gray-500 truncate">{{ img.originalName }}</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
</div>

{{ form_rest(form) }}

<div class="flex items-center justify-end gap-3 pt-2">
	<a href="{{ path('admin_product_index') }}" class="rounded-xl border bg-white px-4 py-2.5 text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2">
		İptal
	</a>
	<button class="rounded-xl bg-black px-4 py-2.5 text-sm font-medium text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2" type="submit">
		{{ button_label|default('Kaydet') }}
	</button>
</div>

{{ form_end(form) }}

<script>
	(function () {
const dz = document.getElementById('dropzone');
const input = document.getElementById('{{ form.imageFiles.vars.id }}');
const list = document.getElementById('filelist');

if (! dz || ! input) 
return;



function renderFiles(files) {
if (! list) 
return;


if (! files || files.length === 0) {
list.textContent = '';
return;
}
list.textContent = Array.from(files).map(f => f.name).join(', ');
}

dz.addEventListener('dragover', (e) => {
e.preventDefault();
dz.classList.add('ring-2', 'ring-black');
});
dz.addEventListener('dragleave', () => dz.classList.remove('ring-2', 'ring-black'));
dz.addEventListener('drop', (e) => {
e.preventDefault();
dz.classList.remove('ring-2', 'ring-black');
if (!e.dataTransfer || !e.dataTransfer.files) 
return;


input.files = e.dataTransfer.files;
renderFiles(input.files);
});

input.addEventListener('change', () => renderFiles(input.files));
})();
</script>
